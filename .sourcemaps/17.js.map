{"version":3,"sources":["../../src/pages/move-to-buddy/move-to-buddy.module.ts","../../src/pages/move-to-buddy/move-to-buddy.ts"],"names":[],"mappings":"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","file":"17.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { MoveToBuddyPage } from './move-to-buddy';\n\n@NgModule({\n  declarations: [\n    MoveToBuddyPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(MoveToBuddyPage),\n  ],\n})\nexport class MoveToBuddyPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/move-to-buddy/move-to-buddy.module.ts","import { Component, OnInit  } from '@angular/core';\nimport { IonicPage, NavController, NavParams, ToastController } from 'ionic-angular';\nimport { AuthServiceProvider } from '../../providers/auth-service/auth-service';\nimport { DataServiceProvider } from '../../providers/data-service/data-service';\nimport { ShoppingItem } from '../../models/shopping-item/shopping-item.interface';\nimport { User } from 'firebase/app';\nimport { Profile } from '../../models/profile/profile';\nimport { Subscription } from 'rxjs/Subscription';\nimport { FirebaseListObservable, AngularFireDatabase, FirebaseObjectObservable } from 'angularfire2/database';\n\n\n/**\n * Generated class for the MoveToBuddyPage page.\n *\n * See http://ionicframework.com/docs/components/#navigation for more info\n * on Ionic pages and navigation.\n */\n\n@IonicPage()\n@Component({\n  selector: 'page-move-to-buddy',\n  templateUrl: 'move-to-buddy.html',\n})\nexport class MoveToBuddyPage {\n\n  storeName: string;\n  userProfile: Profile;\n  masterListItemRef$: FirebaseListObservable<ShoppingItem[]>;\n  nextTripItemRef$: FirebaseListObservable<ShoppingItem[]>;\n  \n  private inviteListRef$ : FirebaseListObservable<Notification[]>\n  private shoppingItemRef$ : FirebaseObjectObservable<ShoppingItem>;\n\n  private authenticatedUser : User;\n  private userId: string;\n  private userName: string;\n  private isExist: boolean;\n  private isSelect: boolean; \n   shoppingItem = {} as ShoppingItem;\n   public shopperNames: Array<any>=[];\n   private status: string;\n\n  constructor(public navCtrl: NavController, public navParams: NavParams, private data: DataServiceProvider, private auth: AuthServiceProvider,\n    private db : AngularFireDatabase, public toastCtrl: ToastController) {\n\n      const shoppingItemId = this.navParams.get('shoppingItemId');\n      const storeName = this.navParams.get('storeName');\n      const userid = this.navParams.get('userid');\n      const rootNode = this.navParams.get('rootNode');\n      if(storeName){\n      this.shoppingItemRef$ = this.db.object(`${rootNode}/${userid}/${storeName}/${shoppingItemId}`);\n      }else{\n        this.shoppingItemRef$ = this.db.object(`${rootNode}/${userid}/${shoppingItemId}`);\n      }\n      console.log(`In EditShopping page, shoppingitemid is ${rootNode}/${userid}/${storeName}/${shoppingItemId}`);\n  \n      this.shoppingItemRef$.subscribe(\n        shoppingItem  => this.shoppingItem = shoppingItem);\n        this.storeName = storeName;\n  }\n\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad MoveToBuddyPage');\n    this.isSelect = false;\n    \n  }\n\n  ngOnInit(): void {\n    this.auth.getAuthenticatedUser().subscribe((user: User) => {\n      this.authenticatedUser = user;\n      this.getUserDetails();\n      //this.buddyList = [];\n      this.inviteListRef$ = this.db.list(`/grocerybuddylist/${user.uid}`);\n      this.inviteListRef$.subscribe( inviteList  => {\n        // console.log(inviteList);\n        inviteList.forEach((invite) => {\n          let profileData = this.db.object(`/profiles/${invite['$key']}`);\n          //this.buddyList = [];\n          \n          \n          profileData.subscribe((buddyProfile) => {\n            \n            if(invite['status'] == 'completed') {\n              var name = buddyProfile.firstName +' '+ buddyProfile.lastName;\n              this.shopperNames.push({\n                shopperName: name,\n                key: buddyProfile.$key\n              });\n            }\n          });\n\n        });\n        //console.log(this.buddyList);\n      });\n      this.data.getProfile(user).subscribe(profile => {\n        this.userProfile = <Profile>profile.val();\n      });\n    })\n  }\n\n  getUserDetails(){\n    var usersRef = this.db.list(`/profiles`, {\n      query: {\n          orderByChild: 'email',\n          equalTo: this.authenticatedUser.email , // How to check if participants contain username\n      }\n  });\n\n  usersRef.subscribe(profileList => {\n    \n    this.userName = profileList[0].firstName +' '+ profileList[0].lastName;\n    \n  });\n}\n\n  userSelect(userId){\n    this.userId = userId;\n    this.isSelect = true;\n    \n  }\n\n  /* check whether the item name exist in masterlist, \n     if not save the value */\n     addShoppingItemToMasterList() {\n      // this.loading = this.loadingCtrl.create({\n      //   content: 'Please wait...'\n      // });\n      // this.loading.present();\n      if(this.isSelect==true){\n      var self = this;\n      let key;\n      self.masterListItemRef$ = self.db.list(`/masterlist/${self.userId}`);\n      /* gets firebase data only once */\n      self.masterListItemRef$.$ref.once(\"value\", function (snapshot) {\n        snapshot.forEach(data => {\n         \n          if (data.val().itemName == self.shoppingItem.itemName) {\n            self.isExist = true;\n            \n            \n            key = data.key\n           \n            // self.showToast('Item already exists in Master List', 1000);\n            // self.loading.dismiss();\n          }\n          return false;\n        });\n  \n        if (!self.isExist) {\n          self.saveToFirebaseMasterItemList();\n        }\n        else{\n         \n          self.addToBuddyNextTrip(key);\n        }\n        self.isExist = false;\n      });\n    }else{\n      this.presentToast('Please select buddy');\n    }\n    }\n  \n    /* save the item to firebase\n       check the store value exist or not\n       if not, save store value as None */\n    saveToFirebaseMasterItemList() {\n      console.log('saveToFirebaseMasterItemList');\n      let isSaved;\n      if (this.storeName) {\n        isSaved = this.masterListItemRef$.push({\n          itemName: this.shoppingItem.itemName,\n          store: this.storeName\n        }).key;\n      } else {\n        isSaved = this.masterListItemRef$.push({\n          itemName: this.shoppingItem.itemName,\n          store: \"None\"\n        }).key;\n      }\n  \n      if (isSaved) {\n        // this.loading.dismiss();\n        console.log(isSaved);\n        this.addToBuddyNextTrip(isSaved);\n      }\n    }\n\n    addToBuddyNextTrip(key) {\n\n      var self = this;\n      \n          if (!self.storeName) self.storeName = \"None\";\n      \n          \n          self.nextTripItemRef$ = this.db.list(`/nexttrip/${self.userId}/${self.storeName}`);\n\n          self.nextTripItemRef$.$ref.once(\"value\", function (snapshot) {\n            snapshot.forEach(data => {\n              if (data.val().itemName == self.shoppingItem.itemName && data.val().sharedArray[0].key == self.authenticatedUser.uid) {\n                self.isExist = true;\n                // self.loading.dismiss();\n              }\n              return false;\n            });\n      \n            \n      \n            if (!self.isExist) {\n              self.saveToFirebaseNextTrip(key);\n            \n            }else{ \n              let message = self.shoppingItem.itemName + ' cannot be shared back';       \n              self.presentToast(message);\n            }\n            self.isExist = false;\n          });\n\n         \n        }\n\n        saveToFirebaseNextTrip(key){\n\n          let isSaved;\n          isSaved = this.nextTripItemRef$.push({\n            itemName: this.shoppingItem.itemName,\n            itemNumber: Number(this.shoppingItem.itemNumber),\n            pickedQuantity : Number(0),\n            status: \"shareIn\",\n            sharedArray: [{shopperName: this.userName, key: this.authenticatedUser.uid}]\n            // store: currentShoppingItem.store? currentShoppingItem.store : \"None\"\n          }).key;\n      \n          if (isSaved) {\n            // this.loading.dismiss();\n            this.deleteFromUserList();\n            this.presentToast('Item moved to Buddy Next Trip');\n            \n          }\n        }\n\n    deleteFromUserList(){\n      this.db.object(`/nexttrip/${this.authenticatedUser.uid}/${this.storeName}/` + this.shoppingItem.$key).remove();\n      this.navCtrl.pop();\n    }\n  \n\n   // Configure Toast\n   public presentToast(text) {\n    let toast = this.toastCtrl.create({\n      message: text,\n      duration: 3000\n      // position: 'top'\n    });\n    toast.present();\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/move-to-buddy/move-to-buddy.ts"],"sourceRoot":""}