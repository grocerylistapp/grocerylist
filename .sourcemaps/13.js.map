{"version":3,"sources":["../../src/pages/add-to-my-next-trip-and-master-from-mnt/add-to-my-next-trip-and-master-from-mnt.module.ts","../../src/pages/add-to-my-next-trip-and-master-from-mnt/add-to-my-next-trip-and-master-from-mnt.ts"],"names":[],"mappings":"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","file":"13.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { AddToMyNextTripAndMasterFromMntPage } from './add-to-my-next-trip-and-master-from-mnt';\n\n@NgModule({\n  declarations: [\n    AddToMyNextTripAndMasterFromMntPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(AddToMyNextTripAndMasterFromMntPage),\n  ],\n})\nexport class AddToMyNextTripAndMasterFromMntPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/add-to-my-next-trip-and-master-from-mnt/add-to-my-next-trip-and-master-from-mnt.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, LoadingController } from 'ionic-angular';\n\nimport { ShoppingItem } from '../../models/shopping-item/shopping-item.interface';\nimport { AngularFireDatabase, FirebaseListObservable } from 'angularfire2/database';\nimport { AuthServiceProvider } from '../../providers/auth-service/auth-service';\nimport { DataServiceProvider } from '../../providers/data-service/data-service';\nimport { User } from 'firebase/app';\nimport { Subscription } from 'rxjs/Subscription';\nimport { Store } from '../../models/store/store';\nimport { ToastController } from 'ionic-angular';\nimport { FormBuilder, FormGroup, Validators, FormControl } from '@angular/forms';\nimport { WalmartApiProvider } from '../../providers/walmart-api/walmart-api';\nimport { BarcodeScanner } from '@ionic-native/barcode-scanner';\n\n@IonicPage()\n@Component({\n  selector: 'page-add-to-my-next-trip-and-master-from-mnt',\n  templateUrl: 'add-to-my-next-trip-and-master-from-mnt.html',\n  providers: [WalmartApiProvider]\n})\nexport class AddToMyNextTripAndMasterFromMntPage {\n\n  currentShoppingItem = {} as ShoppingItem;\n  shoppingItemRef$: FirebaseListObservable<ShoppingItem[]>;\n  nextTripItemRef$: FirebaseListObservable<ShoppingItem[]>;\n  storeRef$: FirebaseListObservable<Store[]>;\n  private authenticatedUser: User;\n  private authenticatedUser$: Subscription;\n  private isExist: boolean;\n  private loading;\n  public myForm: FormGroup;\n  public isList: boolean;  // Product item list boolean\n  public productName: string;  // Product name for searching\n  public products: Array<any>; // Products search array\n  private itemQuantity: number;\n\n  constructor(public navCtrl: NavController, public navParams: NavParams, private db: AngularFireDatabase,\n    private auth: AuthServiceProvider, private data: DataServiceProvider, private toast: ToastController,\n    public loadingCtrl: LoadingController, public formBuilder: FormBuilder, private walmartApi: WalmartApiProvider,\n    private barcodeScanner: BarcodeScanner) {\n    this.authenticatedUser$ = this.auth.getAuthenticatedUser().subscribe((user: User) => {\n      this.authenticatedUser = user;\n    });\n    //const shopppingItem : ShoppingItem = this.navParams.get('shoppingItem');\n    if (this.navParams.get('shoppingItem')) {\n      this.currentShoppingItem = this.navParams.get('shoppingItem');\n    }\n    this.isExist = false;\n\n    this.myForm = formBuilder.group({\n      itemName: ['', Validators.required],\n      quantity: [''],\n      storeName: ['']\n    });\n\n    this.myForm.valueChanges.subscribe(data => this.onValueChanged(data));\n  }\n\n  onValueChanged(data?: any) {\n    if (!this.myForm) { return; }\n    const form = this.myForm;\n    for (const field in this.formErrors) {\n      // clear previous error message\n      this.formErrors[field] = [];\n      this.myForm[field] = '';\n      const control = form.get(field);\n      if (control && control.dirty && !control.valid) {\n        const messages = this.validationMessages[field];\n        for (const key in control.errors) {\n          this.formErrors[field].push(messages[key]);\n        }\n      }\n    }\n  };\n\n  formErrors = {\n    'itemName': '',\n    'quantity': '',\n    'storeName': ''\n  };\n\n  validationMessages = {\n    'itemName': {\n      'required': 'Item Name is required.'\n    },\n    'quantity': {},\n    'storeName': {}\n  };\n\n  /* check whether the item name exist in masterlist, \n     if not save the value */\n  addShoppingItemToMasterList() {\n    this.loading = this.loadingCtrl.create({\n      content: 'Please wait...'\n    });\n    this.loading.present();\n    var self = this;\n\n    self.shoppingItemRef$ = self.db.list(`/masterlist/${self.authenticatedUser.uid}`);\n    /* gets firebase data only once */\n    self.shoppingItemRef$.$ref.once(\"value\", function (snapshot) {\n      snapshot.forEach(data => {\n\n        if (data.val().itemName == self.currentShoppingItem.itemName) {\n          self.isExist = true;\n          self.showToast('Item already exists in Master List', 1000);\n          self.loading.dismiss();\n        }\n        return false;\n      });\n\n      if (!self.isExist) {\n        self.saveToFirebaseMasterItemList();\n      }\n      self.isExist = false;\n    });\n  }\n\n  /* save the item to firebase\n     check the store value exist or not\n     if not, save store value as None */\n  saveToFirebaseMasterItemList() {\n    console.log('saveToFirebaseMasterItemList');\n    let isSaved;\n    if (this.currentShoppingItem.store) {\n      isSaved = this.shoppingItemRef$.push({\n        itemName: this.currentShoppingItem.itemName,\n        store: this.currentShoppingItem.store\n      }).key;\n    } else {\n      isSaved = this.shoppingItemRef$.push({\n        itemName: this.currentShoppingItem.itemName,\n        store: \"None\"\n      }).key;\n    }\n\n    if (isSaved) {\n      // this.loading.dismiss();\n      this.saveToFirebaseNextTripList(isSaved);\n    }\n  }\n\n  /* save the item to firebase\n     check the store value exist or not\n     if not, save store value as None */\n  saveToFirebaseNextTripList(key) {\n\n    if (!this.currentShoppingItem.store) this.currentShoppingItem.store = \"None\";\n\n    let isSaved;\n    this.nextTripItemRef$ = this.db.list(`/nexttrip/${this.authenticatedUser.uid}/${this.currentShoppingItem.store}`);\n    if (!this.currentShoppingItem.itemNumber) this.currentShoppingItem.itemNumber = 0;\n    isSaved = this.nextTripItemRef$.push({\n      itemName: this.currentShoppingItem.itemName,\n      itemNumber: Number(this.currentShoppingItem.itemNumber)\n      // store: currentShoppingItem.store? currentShoppingItem.store : \"None\"\n    }).key;\n\n    if (isSaved) {\n      this.loading.dismiss();\n      this.showToast('Item added to the My Next Trip', 1000);\n      this.navCtrl.pop();\n    }\n  }\n\n  /* search for a product with keyword*/\n  searchProduct(event, key) {\n\n    /* search activates only if the letter typed exceeds one*/\n    if (event.target.value.length > 1) {\n      var temp = event.target.value;\n\n      /* Call Api to get product details */\n      this.walmartApi.getProductDetaisByKeyword(temp).subscribe(\n        data => {\n          /* Set Api response values */\n          this.products = data.items;\n          this.isList = true;\n        },\n        err => {\n          /* Set Api response error */\n          console.log(err);\n        },\n        () => console.log('Product Search Complete')\n      );\n    }\n  }\n\n  /* Item tapped event on the item list */\n  itemTapped(event, item) {\n    this.currentShoppingItem.itemName = item.name;\n    this.products = [];\n    this.isList = false;\n  }\n  \n  /* call barcode plugin to scan the barcode */\n  scanWalmartCode() {\n    this.barcodeScanner.scan().then((barcodeData) => {\n      /* Success! Barcode data is here */\n      this.getBarcodeProductDetails(barcodeData.text);\n    }, (err) => {\n      // An error occurred\n      console.log('err ='+ JSON.stringify(err));\n    });\n  }\n\n  /* get item detail from walmart using UPC */\n  getBarcodeProductDetails(data) {\n    /* Call Api to get product details */\n    this.walmartApi.getProductDetaisByUPC(data).subscribe(\n      data => {\n        this.currentShoppingItem.itemName = data.items[0].name;\n      },\n      err => {  // Api response error\n        console.log('err ='+ JSON.stringify(err));\n      },\n      () => console.log('Product Search Complete')\n    );\n  }\n\n  /* show toast message dynamically */\n  showToast(message, time) {\n    this.toast.create({ message: message, duration: time }).present();\n  }\n\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/add-to-my-next-trip-and-master-from-mnt/add-to-my-next-trip-and-master-from-mnt.ts"],"sourceRoot":""}